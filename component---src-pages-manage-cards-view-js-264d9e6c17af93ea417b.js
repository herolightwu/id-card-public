(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{"8Cta":function(e,t,a){"use strict";a.r(t),a.d(t,"ViewManageCard",(function(){return B}));var r=a("dI71"),o=(a("eiRb"),a("q1tI")),s=a.n(o),n=a("vDqi"),i=a.n(n),l=a("Wbzz"),c=a("/MKj"),d=a("Z3vd"),m=a("oCA+"),p=a("7oih"),u=a("tRbT"),h=a("kKAo"),g=a("+Isj"),f=a("iae6"),_=a("tr08"),v=a("C7fm"),b=a("YZMd"),E=a("lopY"),w=a("+n12"),C=a("XX3T"),S=a("gXA7"),y=a.n(S),O=a("lpWn"),k=a("wpBK"),x=a("CkNY"),j=x.c+"/api",D=[{label:"Card Program",placeholder:"Card Program Name",type:"text",name:"program_name"},{label:"Card ID",placeholder:"Card ID Number",type:"text",name:"card_id"},{label:"Card Status",placeholder:"Status",type:"text",name:"available"}],B=function(e){function t(t){var a;return(a=e.call(this,t)||this).onSave=function(){for(var e=localStorage.getItem("token"),t=localStorage.getItem("userId"),r=x.a+"/api/encode/",o={Authorization:"Bearer "+e},s=a.state.formFields,n=!0,l={},c=0;c<s.length;c++)s[c].value||1==c||4==c||(l[s[c].name]="This field is required",n=!1);if(a.setState({showError:l}),n){for(var d={},m={},p={},u=0;u<s.length;u++)s[u].extend?p[s[u].name]=s[u].value:m[s[u].name]=s[u].value;delete m.program_name,delete m.card_id,delete m.available,d.code_fields=m,d.server_fields=p,d.compressed_image=a.state.webp,d.program_id=a.props.location.state.program_id,d.created_user=t,d.modified_user=t,d.available=!0;var h={};h.message=d,h.matrixsize=a.state.card_program.matrix_size,h.compression=a.state.card_program.compression,h.edac=a.state.card_program.edac,a.setState({loader:!0}),i.a.post(r,h,{headers:o}).then((function(e){"success"===e.data.status?a.setState({barcode:e.data.data,openOrderConfirm:!0,loader:!1}):a.setState({loader:!1,showError:!0,message:e.data.message.toString()})})).catch((function(e){a.setState({loader:!1,showError:!0,message:e.toString()})}))}},a.onCancel=function(){var e=a.state.formFields;Object.entries(a.props.location.state).forEach((function(t){for(var a=t[0],r=t[1],o=0;o<e.length;o++)a==e[o].name&&(e[o].value=r)})),a.props.location.state.code_fields&&Object.entries(a.props.location.state.code_fields).forEach((function(t){for(var a=t[0],r=t[1],o=0;o<e.length;o++)a==e[o].name&&(e[o].value=r)})),a.props.location.state.server_fields&&Object.entries(a.props.location.state.server_fields).forEach((function(t){for(var a=t[0],r=t[1],o=0;o<e.length;o++)a==e[o].name&&(e[o].value=r)})),a.setState({openOrderConfirm:!1,showEditButton:!0,barcode:a.props.location.state.barcode,formFields:e,webp:a.props.location.state.compressed_face_image,photo:a.props.location.state.face_image,showError:!1})},a.onConfirmOrder=function(){for(var e=localStorage.getItem("token"),t=localStorage.getItem("userId"),r=j+"/cards/",o={Authorization:"Bearer "+e},s=a.state.formFields,n={},l={},c={},d=0;d<s.length;d++)s[d].extend?c[s[d].name]=s[d].value:l[s[d].name]=s[d].value;n.card_id=l.card_id,n.card_status=l.available,delete l.program_name,delete l.card_id,delete l.available,n.face_image=a.state.photo,n.compressed_face_image=a.state.webp,n.program_id=a.props.location.state.program_id,n.code_fields=l,n.server_fields=c,n.barcode=a.state.barcode,n.nfc_fields="",n.modified_user=t,i.a.put(r,n,{headers:o}).then((function(e){console.log("response : ",e),"unauthorized"===e.data.status?a.setState({loader:!1,showError:!0,message:e.data.message.toString()}):a.setState({resultTitle:"Your card has been updated. Finish update?",openResultDlg:!0,loader:!1,showCodeLabel:!1,showEditButton:!0,showError:!1})})).catch((function(e){a.setState({loader:!1,showError:!0,message:e})})),a.setState({loader:!0,openOrderConfirm:!1})},a.onPrint=function(){for(var e=localStorage.getItem("token"),t=localStorage.getItem("userId"),r=j+"/generate_card",o={Authorization:"Bearer "+e},s=a.state.formFields,n={},l={},c={},d=0;d<s.length;d++)s[d].extend?c[s[d].name]=s[d].value:l[s[d].name]=s[d].value;n.face_image=a.state.photo,n.compressed_face_image=a.state.webp,n.code_fields=l,n.server_fields=c,n.program_id=a.props.location.state.program_id,n.barcode=a.state.barcode,n.barcode_size=a.state.card_program.matrix_size,n.modified_user=t,n.front_image=a.state.card_program.card_image_front,n.back_image=a.state.card_program.card_image_back,n.logo=a.state.card_program.logo,i.a.post(r,n,{headers:o}).then((function(e){console.log("response : ",e),"Unauthorized"===e.data.status?a.setState({loader:!1,showError:!0,message:e.data.message.toString()}):a.setState({resultTitle:"Virtual Card has generated. "+x.c+"/vcards/"+e.data.vcard,openResultDlg:!0,loader:!1,showCodeLabel:!1,showEditButton:!0,showError:!1})})).catch((function(e){a.setState({loader:!1,showError:!0,message:e})})),a.setState({loader:!0,openOrderConfirm:!1})},a.state={isLogin:!0,showEditButton:!0,formFields:D,openOrderConfirm:!1,resultTitle:"",openResultDlg:!1,loader:!1,isPhotoChanged:!1,webp:t.location.state.compressed_face_image,photo:t.location.state.face_image,showError:{},barcode:"",created_user:{},card_program:{}},a}Object(r.a)(t,e);var a=t.prototype;return a.formFields=function(e,t){for(var a=this.state.formFields,r=0;r<a.length;r++)a[r].placeholder==t&&(a[r].value=e)},a.componentDidMount=function(){var e=this.props;e.dispatch,e.userData,e.basicData;this.setState({barcode:this.props.location.state.barcode}),this.getCreatedUser(),this.getCardProgram()},a.getCardProgram=function(){var e=this,t={Authorization:"Bearer "+localStorage.getItem("token")};return new Promise((function(a){var r=x.c+"/api/cardprogram/"+e.props.location.state.program_id;i.a.get(r,{headers:t}).then((function(t){var r=t.data.data;e.setState({card_program:r[0]},(function(){e.setFieldValues()})),a(r[0])})).catch((function(e){return console.log(e),Object(l.navigate)("/manage-cards/"),null})).finally((function(){}))}))},a.setFieldValues=function(){for(var e=this.state.card_program.program_template,t=[],a=0;a<D.length;a++)t.push(D[a]);for(var r=0;r<e.length;r++)e[r].name=e[r].label.toString().toLowerCase().replace(/\s/g,"_"),t.push(e[r]);console.log("form fileds :",t),console.log("data :",this.props.location.state),Object.entries(this.props.location.state).forEach((function(e){for(var a=e[0],r=e[1],o=0;o<t.length;o++)a===t[o].name&&(t[o].value=r)})),this.props.location.state.code_fields&&Object.entries(this.props.location.state.code_fields).forEach((function(e){for(var a=e[0],r=e[1],o=0;o<t.length;o++)a===t[o].name&&(t[o].value=r)})),this.props.location.state.server_fields&&Object.entries(this.props.location.state.server_fields).forEach((function(e){for(var a=e[0],r=e[1],o=0;o<t.length;o++)a===t[o].name&&(t[o].value=r)})),console.log("code fileds; ",this.props.location.state.code_fields),console.log("server fields: ",this.props.location.state.server_fields),console.log("form fields: ",t),this.setState({formFields:t})},a.getCreatedUser=function(){var e=this,t={Authorization:"Bearer "+localStorage.getItem("token")};return new Promise((function(a){var r=x.c+"/api/users/"+e.props.location.state.created_user;i.a.get(r,{headers:t}).then((function(t){var r=t.data.data;e.setState({created_user:r[0]}),a(r[0])})).catch((function(e){return console.log(e),Object(l.navigate)("/manage-cards/"),null})).finally((function(){}))}))},a.render=function(){var e=this,t=this.props,a=(t.userData,t.classes),r=t.transitionDuration,o=t.isDesktop,n={width:o?"50%":120,float:"right",marginLeft:5,marginRight:5,marginBottom:20,minWidth:120},i=o?{minWidth:150}:{minWidth:"90vw"};return s.a.createElement(p.a,{menuIndex:this.props.menuIndex},s.a.createElement(u.a,{container:!0,justify:"center",spacing:2,style:{minHeight:"100%"}},s.a.createElement(u.a,{item:!0,sm:4,xs:12,className:a.cardViewGridLeft},s.a.createElement(v.a,{editMode:!this.state.showEditButton,card_id:this.props.location.state.card_id,program_id:this.props.location.state.program_id,program_front:this.state.card_program.card_image_front,program_back:this.state.card_program.card_image_back,logo:this.state.card_program.logo,first_name:this.props.location.state.first_name,middle_name:this.props.location.state.middle_name,last_name:this.props.location.state.last_name,webp:this.state.webp,photo:this.state.photo,ordered_date:this.props.location.state.ordered_date,created_user:this.state.created_user,barcode:this.state.barcode,onChanged:function(t,a){console.log("picture changed"),e.setState({isPhotoChanged:!0,webp:t,photo:a})}})),s.a.createElement(u.a,{item:!0,sm:5,xs:12,className:a.cardViewGrid,style:{marginRight:5}},s.a.createElement(h.a,{style:{padding:"0 10px"},elevation:0},this.state.formFields.map((function(t,a){var r=!0,o="";return t.name&&!e.state.showEditButton&&(r=!1,o=e.state.showError[t.name]),s.a.createElement(O.a,{key:w.a.getKey(),label:t.label,type:t.type,value:t.value,placeholder:t.placeholder,formFields:e.formFields.bind(e),showError:o,disable:r})})))),s.a.createElement(u.a,{item:!0,md:3,sm:12,className:a.cardViewGrid,style:i},s.a.createElement(h.a,{style:{padding:10,display:"flex",width:"100%",flexDirection:o?"column":"row",justifyContent:"center",alignItems:o?"stretch":"center",flexWrap:o?"nowrap":"wrap"},elevation:0},this.state.showEditButton?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",null,s.a.createElement(d.a,{variant:"contained",size:"medium",color:"primary",style:n,onClick:function(){Object(l.navigate)("/manage-cards/")}},"Next Card")),s.a.createElement("div",null,s.a.createElement(d.a,{variant:"contained",size:"medium",color:"primary",style:n,onClick:this.onPrint},"Print")),s.a.createElement("div",null,s.a.createElement(d.a,{variant:"contained",size:"medium",color:"primary",style:n},"Write NFC")),s.a.createElement("div",null,s.a.createElement(d.a,{variant:"contained",size:"medium",color:"secondary",style:n},"Reject"))):s.a.createElement(s.a.Fragment,null,s.a.createElement("div",null,s.a.createElement(d.a,{variant:"contained",size:"medium",color:"primary",style:n,onClick:this.onSave,disabled:this.state.showEditButton},"Update")),s.a.createElement("div",null,s.a.createElement(d.a,{variant:"contained",size:"medium",color:"primary",style:n,onClick:this.onCancel},"cancel")))))),s.a.createElement(b.a,{key:w.a.getKey(),in:this.state.showEditButton,timeout:r,style:{transitionDelay:"500ms"},unmountOnExit:!0},s.a.createElement(C.a,{"aria-label":"",style:{position:"fixed",bottom:20,right:30},color:"primary",onClick:function(){e.setState({showEditButton:!e.state.showEditButton})}},s.a.createElement("img",{src:y.a,style:{width:25,objectFit:"contain",marginTop:25}}))),s.a.createElement(k.a,{title:"You are about to update this card, Are you sure you want to do this?",open:this.state.openOrderConfirm,okTitle:"Update",onOk:this.onConfirmOrder,onCancel:this.onCancel}),s.a.createElement(k.a,{title:this.state.resultTitle,open:this.state.openResultDlg,okTitle:"OK",cancel:"",onOk:function(){e.setState({showEditButton:!0,openResultDlg:!1})},onCancel:function(){e.setState({showEditButton:!1,openResultDlg:!1})}}),s.a.createElement(g.a,{className:a.backdrop,open:this.state.loader},s.a.createElement(f.a,{color:"inherit"})))},t}(s.a.Component);t.default=function(e){var t=Object(c.useDispatch)(),a=(Object(c.useSelector)((function(e){return e.app.userData})),Object(m.a)()),r=Object(_.a)(),o={enter:r.transitions.duration.enteringScreen,exit:r.transitions.duration.leavingScreen},n=Object(E.a)("(min-width:1053px)");return s.a.createElement(B,Object.assign({},e,{menuIndex:0,dispatch:t,isDesktop:n,classes:a,transitionDuration:o}))}}}]);
//# sourceMappingURL=component---src-pages-manage-cards-view-js-264d9e6c17af93ea417b.js.map